---
layout: post
title: "RANSAC이란?"
description: RANSAC 알고리즘을 간단한 예제로 알아봅니다.
tags: Algorithm
# date: 2020-03-04 14:39:02
comments: true
---

RANSAC(RANdom SAmple Consensus)는 이름에서 알 수 있듯이

```py
import matplotlib.pyplot as plt
import numpy as np
import random
import numpy.matlib
from math import sqrt

def norm(A):
    return sqrt(A[0]**2+A[1]**2)

def repeatCopy(arg,size):
    t1 = [arg[0]]*size
    t2 = [arg[1]]*size
    result = [t1,t2]
    return np.array(result)

# return index
def findin(arg,threshold):
    result = []
    for i in range(len(arg)):
        if abs(arg[i]) <= threshold:
            result.append(i)
    return result

def ransac_demo(data,thrheshold_dist,inlier_ratio,num,loop_const):
    bestInNum = 0
    print("data shape :",np.array(data).shape)
    while bestInNum == 0:
        bestParameter1,bestParameter2 = 0.0,0.0
        bestInlier_list = []
        for i in range(len(data)*loop_const):
            idx = random.sample(range(num),2)
            sample = [[data[0][idx[0]],data[1][idx[0]]],[data[0][idx[1]],data[1][idx[1]]]]
            kLine = np.subtract(sample[0],sample[1])
            klineNorm = kLine / norm(kLine)
            normVector = np.array([-klineNorm[1],klineNorm[0]])
            sub_mat = np.subtract(data,repeatCopy(sample[0],num))
            # print(np.matlib.repmat(sample[0],2,50))
            distance = np.dot(normVector,sub_mat)

            # distance is 1-D vector
            inlier_idx = findin(distance,thrheshold_dist)
            # print("inlier_idx",inlier_idx)
            inlier_num = len(inlier_idx)
            if inlier_num >= inlier_ratio * num and inlier_num > bestInNum:
                tmp_list = [[],[]]
                for j in inlier_idx:
                    tmp_list[0].append(data[0][j])
                    tmp_list[1].append(data[1][j])
                bestInlier_list = tmp_list.copy()
                bestInNum = inlier_num
                p1 = (sample[1][1] - sample[0][1])/(sample[1][0] - sample[0][0])
                p2 = sample[0][1] - p1*sample[0][0]
                bestParameter1,bestParameter2 = p1,p2
    print('data num :',num)
    print('bestInNum :',bestInNum)
    
    return bestParameter1,bestParameter2,bestInlier_list

def sample_line(x):
    return x + 3


if __name__ == "__main__":
    sample_n = 100
    noise_ratio = 2
    sample_data = [[],[]]
    for i in range(sample_n):
        if i % 2 == 0:
            sample_data[0].append(random.random()*sample_n)
            sample_data[1].append(random.random()*sample_n)
        else:
            sample_data[0].append(i+float(random.sample([-1,1],1)[0])*random.random()*noise_ratio)
            sample_data[1].append(sample_line(i+float(random.sample([-1,1],1)[0])*random.random()*noise_ratio) + float(random.sample([-1,1],1)[0])*random.random()*noise_ratio)
    
    # for i in range(1,100):
    p1,p2,inlier = ransac_demo(sample_data,1,0.1,sample_n,1)
    print(p1,p2)
    ransac_result_x = np.array(list(range(0,100,1)))
    true_result_y = sample_line(ransac_result_x)
    ransac_result_y = np.multiply(ransac_result_x,p1) + p2
    # plt.scatter(inlier[0],inlier[1],c='red',s=5,label='inlier')
    plt.scatter(sample_data[0],sample_data[1],s=5,label='data')
    plt.plot(ransac_result_x,ransac_result_y,label='estimation line loop const')
    plt.plot(ransac_result_x,true_result_y,c='green',label='truth line',linewidth=3)
    plt.legend()
    plt.grid()
    # plt.pause(1)
        # plt.clf()
    plt.show()
    pass
```



---

<details>
<summary>참고문서</summary>
<div markdown="1">

- [RANSAC의 이해와 영상처리 활용](https://darkpgmr.tistory.com/61)

</div>
</details>
<script id="dsq-count-scr" src="//msc9533.disqus.com/count.js" async></script>

